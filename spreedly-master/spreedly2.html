<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
	.align{
		margin-bottom: 15px;
	}

	</style>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<script src="spreedly.js"></script>
	<script type="text/javascript">
		$(document).ready(function () {

			$("#payment_method").click(function () {
			    var firstName = $("#firstname").val();
			    var lastName = $("#lastname").val();
			    var cardNumber = $("#cardNumber").val();
			    var month = $("#month").val();
			    var year = $("#year").val();
			    var cvv = $("#cvv_payment").val();
			    var payment_method_identifier = $("#payment_method_identifier").val();
			    var some_other_things = $("#some_other_things").val();
			    //with billing 
			    // var address_1 = $("#address_1").val();
			    // var address_2 = $("#address_2").val();
			    // var city = $("#city").val();
			    // var state = $("#state").val();
			    // var zip = $("#zip").val();
			    // var country = $("#country").val();
			    // var phone_number = $("#phone_number").val();
			    var email = $("#email").val();

			     // alert(firstName+'\n\n'+lastName+'\n\n'+cardNumber+'\n\n'+month+'\n\n'+year+'\n\n'+cvv+'\n\n'+ address_1+'\n\n'+address_2+'\n\n'+city+'\n\n'+state+'\n\n'+zip+'\n\n'+country+'\n\n'+phone_number);
			   	payment_method(firstName, lastName, cardNumber, month, year, cvv, email, payment_method_identifier, some_other_things);

			});

			$("#process_payment").click(function () {
			    var process_token_request = $("#process_token_request").val();
			    var process_amount = $("#process_amount").val();
			    var currency_code = $("#currency_code").val();

			     // alert(firstName+'\n\n'+lastName+'\n\n'+cardNumber+'\n\n'+month+'\n\n'+year+'\n\n'+cvv+'\n\n'+ address_1+'\n\n'+address_2+'\n\n'+city+'\n\n'+state+'\n\n'+zip+'\n\n'+country+'\n\n'+phone_number);
			     alert(process_token_request+'\n\n'+process_amount+'\n\n'+currency_code);
			   	 process_payment(process_token_request, process_amount, currency_code);

			});

		  	function payment_method(firstName, lastName, cardNumber, month, year, cvv, email, payment_method_identifier, some_other_things){
		  		alert(firstName+'\n\n'+lastName+'\n\n'+cardNumber+'\n\n'+cvv+'\n\n'+month+'\n\n'+year+'\n\n'+email+'\n\n'+payment_method_identifier+'\n\n'+some_other_things);

			   var card = {
				  "payment_method":{
				    "credit_card":{
				      "first_name": firstName,
				      "last_name": lastName,
				      "number":cardNumber,
				      "verification_value":cvv,
				      "month":month,
				      "year":year,
				      "email": email
				    },
				    "data": {
				      "my_payment_method_identifier": payment_method_identifier,
				      "extra_stuff": {
				        "some_other_things": some_other_things
				      }
				    }
				  }
				} 
				var url = "https://core.spreedly.com/v1/payment_methods.json?environment_key=8swOjWN7iUOAozk0w0tj9gvMBY8";

				$.ajax({
				  type: "POST",
				  url: url,
				  dataType: "json",
				  data: card
				}).success(function(data) {
				  console.log(data);
				  var token_result = data.transaction.payment_method.token;
					document.getElementById("process_token_request").value = token_result;
				}).error(function(request, status, error) {
				  console.log(error);
				  // alert('error');
				  document.getElementById("process_token_request").value = 'Unexpected error>';
				});

				
		    };// payment_method function end

		    function process_payment(process_token_request, process_amount, currency_code){
		    	// var transaction =   "<transaction> \
							// 	        <payment_method_token>"+process_token_request+"</payment_method_token> \
							// 	        <amount>"+amount+"</amount>\
							// 	        <currency_code>"+currency_code+"</currency_code>\
							// 	    </transaction>"
				var transaction = {
					"transaction": {
						"payment_method_token":  process_token_request,
						"process_amount": process_amount,
						"currency_code": currency_code
					}
				}

				var url = "https://core.spreedly.com/v1/gateways/CUK6uXH1GiQnxV2kW6apTPbJoi/purchase.xml?environment_key=8swOjWN7iUOAozk0w0tj9gvMBY8";

				$.ajax({
				  type: "POST",
				  url: url,
				  dataType: "json",
				  data: transaction
				}).success(function(data) {
				  console.log(data);
				  
				}).error(function(request, status, error) {
				  console.log(error);
				  // alert('error');
				});
		    }

		});// $(document).ready(function(){ }); end

	</script>
</head>
<body>
<div style="border: 1px solid #000; padding: 10px; margin-bottom: 20px;">
<pre>Use this as sample:</pre>
<pre>
firstName: 'Bob',
lastName: 'Smith',
number: '4111111111111111',
month: 12,
year: 2017,
cvv: '123'
payment method identifier: '448',
some other things: 'Can be anything really',
</pre>
</div>
<hr>
<!-- For Payment_method -->
<div>Firstname: </div> <input type="text" id="firstname" name="firstname" placeholder="Firstname"/>
<div>Lastname: </div> <input type="text" id="lastname" name="lastname" placeholder="Lastname"/>
<div>Card Number: </div> <input type="text" id="cardNumber" name="cardNumber" placeholder="Card Number"/>
<div>Exp: </div> 
<select id="month" name="month">
	<option value="">Month</option>
	<option value="1">January</option>
	<option value="2">February</option>
	<option value="3">March</option>
	<option value="4">April</option>
	<option value="5">May</option>
	<option value="6">June</option>
	<option value="7">July</option>
	<option value="8">August</option>
	<option value="9">September</option>
	<option value="10">October</option>
	<option value="11">November</option>
	<option value="12">December</option>
</select>
<select id="year" name="year">
	<option value="">Year</option>
	<option value="2014">2014</option>
	<option value="2015">2015</option>
	<option value="2016">2016</option>
	<option value="2017">2017</option>
	<option value="2018">2018</option>
	<option value="2021">2021</option>
	<option value="2021">2021</option>
	<option value="2021">2021</option>
</select>
<div>CVV: </div> <input type="text" id="cvv_payment" name="cvv_payment" placeholder="ccv"/> <br>
<div>Payment Method Identifier:</div><input type="text" name="payment_method_identifier" id="payment_method_identifier" placeholder="identifier"/>
<div>Some other thing:</div><input type="text" name="some_other_things" id="some_other_things"/>
<div>Email</div><input type="text" id="email" name="email" placeholder="spreedly@email.com"/>
<!-- <hr>
Billing Address
<div class="align"><input type="text" id="address_1" name="address_1" placeholder="Address 1"/></div>
<div class="align"><input type="text" id="address_2" name="address_2" placeholder="Address 2"/></div>
<div class="align"><input type="text" id="city" name="city" placeholder="City"/></div>
<div class="align"><input type="text" id="state" name="state" placeholder="State"/></div>
<div class="align"><input type="text" id="zip" name="zip" placeholder="Zip"/></div>
<div class="align"><input type="text" id="country" name="country" placeholder="Country"/></div>
<div class="align"><input type="text" id="phone_number" name="phone_number" placeholder="Phone Number"/></div>-->
<br> 
<input type="submit" id="payment_method" name="payment_method" placeholder="Payment Method"/>
<!-- End For Payment_method -->
<hr/>
<div class="align"><input type="text" id="process_token_request" name="process_token_request" placeholder="Token requested"/></div>
<div class="align"><input type="number" id="process_amount" name="process_amount" placeholder="Process Amount"/></div>
<div class="align"><input type="text" id="currency_code" name="currency_code" placeholder="Ex: USD"/></div>
<input type="submit" id="process_payment" name="process_payment" value="Process Payment"/>

</body>
</html>
