(function(e){e.widget("metro.scrollbar",{version:"1.0.0",options:{height:"100%",width:"100%",axis:["x","y"],wheel:55},startSize:{width:null,height:null},elemPadding:!1,bothScroll:!1,scrollbar:null,contentHeight:0,contentWidth:0,contentMinHeight:0,contentMinWidth:0,dragElem:null,dragStart:!1,startCoords:{x:0,y:0},currCoords:{x:0,y:0},handlers:!1,_create:function(){var t=this.element,n=this;if(t.data("scroll")!=undefined){var r=t.data("scroll");r=="vertical"&&(this.options.axis="y");r=="horizontal"&&(this.options.axis="x");r=="both"&&(this.options.axis=["x","y"])}t.data("height")!=undefined&&(this.options.height=t.data("height"));t.data("width")!=undefined&&(this.options.width=t.data("width"));t.data("wheel")!=undefined&&(this.options.wheel=t.data("wheel"));t.css({position:"relative"});var i=t.outerWidth(),s=t.outerHeight();this.contentMinWidth=i;this.contentMinHeight=s;this.startSize.width=this.options.width;this.startSize.height=this.options.height;var o=this.startSize.width==parseInt(this.startSize.width)?this.startSize.width+"px":this.startSize.width,u=this.startSize.height==parseInt(this.startSize.height)?this.startSize.height+"px":this.startSize.height;t.wrap('<div class="scrollbar" style="width: '+o+"; height: "+u+';"></div>');this.scrollbar=t.parents(".scrollbar").first();this.scrollbar.parents().first().css({overflow:"hidden"});this._build(i,s);e(window).resize(function(){n._resize()})},_resize:function(){var e=this.element;if(!isNaN(parseInt(this.element.css("left")))&&parseInt(this.element.css("left"))!=0||!isNaN(parseInt(this.element.css("top")))&&parseInt(this.element.css("top"))){var t=Math.abs(parseInt(this.element.css("left"))),n=Math.abs(parseInt(this.element.css("top"))),r=this.scrollbar.width(),i=this.scrollbar.height();if(this.contentWidth-t<r){t-=r-(this.contentWidth-t);t<0&&(t=0);this.element.css("left",t*-1)}this.element.css("left",t*-1);if(this.contentHeight-n<i){n-=i-(this.contentHeight-n);n<0&&(n=0);this.element.css("top",n*-1)}}this.options.width=this.startSize.width;this.options.height=this.startSize.height;this.scrollbar.css({padding:0});if(this.elemPadding){this.element.css({paddingRight:"-=5",paddingBottom:"-=5"});this.elemPadding=!1}this.scrollbar.find(".scrollbar-v").length>0&&this.scrollbar.find(".scrollbar-v").remove();this.scrollbar.find(".scrollbar-h").length>0&&this.scrollbar.find(".scrollbar-h").remove();this.scrollbar.find(".scrollbar-both").length>0&&this.scrollbar.find(".scrollbar-both").remove();var s=e.outerWidth(),o=e.outerHeight();this.contentWidth=s;this.contentHeight=o;this._removeHandlers();this._build(s,o)},_build:function(e,t){var n=this.element;this.options.width=this.options.width=="100%"?this.scrollbar.outerWidth():this.options.width;this.options.height=this.options.height=="100%"?this.scrollbar.outerHeight():this.options.height;this.scrollbar.css({width:this.startSize.width,height:this.startSize.height});this.contentWidth=e;this.contentHeight=t;if(this.options.axis=="y")if(this.contentHeight>this.options.height){this.scrollbar.css({paddingRight:20,paddingBottom:0});var e=n.outerWidth(),t=n.outerHeight();this.contentWidth=e;this.contentHeight=t;this._verticalScrollbar();this._startHandlers()}else{this.scrollbar.find(".scrollbar-v").length>0&&this.scrollbar.find(".scrollbar-v").hide();this.scrollbar.css({paddingRight:0,paddingBottom:0})}else if(this.options.axis=="x")if(this.contentWidth>this.options.width){if(this.startSize.height=="100%"){this.scrollbar.css({paddingBottom:20,paddingRight:0});var e=n.outerWidth(),t=n.outerHeight();this.contentWidth=e;this.contentHeight=t}this._horizontalScrollbar();this._startHandlers()}else{this.scrollbar.find(".scrollbar-h").length>0&&this.scrollbar.find(".scrollbar-h").hide();this.scrollbar.css({paddingBottom:0,paddingRight:0})}else if(this.contentHeight>this.options.height&&this.contentWidth>this.options.width){this.bothScroll=!0;this.scrollbar.find(".scrollbar-both").length>0?this.scrollbar.find(".scrollbar-both").show():this.scrollbar.append('<div class="scrollbar-both"></div>');if(!this.elemPadding){this.element.css({paddingRight:"+=5",paddingBottom:"+=5"});this.elemPadding=!0}var e=n.outerWidth(),t=n.outerHeight();this.contentWidth=e;this.contentHeight=t;this._verticalScrollbar();this._horizontalScrollbar();this._startHandlers()}else{this.bothScroll=!1;this.scrollbar.find(".scrollbar-both").length>0&&this.scrollbar.find(".scrollbar-both").hide();if(this.elemPadding){this.element.css({paddingRight:"-=5",paddingBottom:"-=5"});this.elemPadding=!1}if(this.contentWidth>this.options.width){if(this.startSize.height=="100%"){this.scrollbar.css({paddingBottom:20,paddingRight:0});var e=n.outerWidth(),t=n.outerHeight();this.contentWidth=e;this.contentHeight=t}this._horizontalScrollbar();this._startHandlers()}else{this.scrollbar.find(".scrollbar-h").length>0&&this.scrollbar.find(".scrollbar-h").hide();this.scrollbar.css({paddingBottom:0,paddingRight:0})}if(this.contentHeight>this.options.height){this.scrollbar.css({paddingRight:20,paddingBottom:0});var e=n.outerWidth(),t=n.outerHeight();this.contentWidth=e;this.contentHeight=t;this._verticalScrollbar();this._startHandlers()}else{this.scrollbar.find(".scrollbar-v").length>0&&this.scrollbar.find(".scrollbar-v").hide();this.scrollbar.css({paddingRight:0,paddingBottom:0})}}},_verticalScrollbar:function(){if(this.scrollbar.find(".scrollbar-v").length<1){var e=[];e[e.length]='<div class="scrollbar-v">';e[e.length]='<div class="scrollbar-v-up"></div>';e[e.length]='<div class="scrollbar-v-down"></div>';e[e.length]='<div class="scrollbar-line-v">';e[e.length]='<div class="scrollbar-line-v-btn"></div>';e[e.length]="</div>";e[e.length]="</div>";e=e.join("");this.scrollbar.append(e)}else this.scrollbar.find(".scrollbar-v").show();var t=this.scrollbar.find(".scrollbar-line-v"),n=this.scrollbar.find(".scrollbar-line-v-btn"),r=this.scrollbar.find(".scrollbar-v");if(this.bothScroll){r.height(this.options.height);var i=r.height()-15;this.options.height=i;r.height(i)}else r.height(this.options.height);var s=this.options.height-32,o=s/this.contentHeight;t.height(s);if(o>=(this.contentHeight-32)/this.contentHeight)n.hide();else{var u=o*this.options.height;n.show().height(u)}},_horizontalScrollbar:function(){if(this.scrollbar.find(".scrollbar-h").length<1){var e=[];e[e.length]='<div class="scrollbar-h">';e[e.length]='<div class="scrollbar-h-up"></div>';e[e.length]='<div class="scrollbar-h-down"></div>';e[e.length]='<div class="scrollbar-line-h">';e[e.length]='<div class="scrollbar-line-h-btn"></div>';e[e.length]="</div>";e[e.length]="</div>";e=e.join("");this.scrollbar.append(e)}else this.scrollbar.find(".scrollbar-h").show();var t=this.scrollbar.find(".scrollbar-line-h"),n=this.scrollbar.find(".scrollbar-line-h-btn"),r=this.scrollbar.find(".scrollbar-h");if(this.bothScroll){r.width(this.options.width);var i=r.width()-15;this.options.width=i;r.width(i)}else r.width(this.options.width);var s=this.options.width-32,o=s/this.contentWidth,u=o*this.options.width,a=isNaN(parseInt(this.element.css("left")))?0:parseInt(this.element.css("left")),f=Math.abs(a)*o;t.width(s);o>=(this.contentWidth-32)/this.contentWidth?n.hide():n.show().width(u).css({left:f})},_startHandlers:function(){if(this.handlers)return!1;this.handlers=!0;var t=this;e(document).mousemove(function(e){t._drag(e)});e(document).mouseup(function(e){t._dragEnd(e)});this.scrollbar.find(".scrollbar-line-v-btn,.scrollbar-line-h-btn").on("mousedown",function(n){t._dragStart(n,e(this))});this.scrollbar.find(".scrollbar-line-v,.scrollbar-line-h").on("click",function(n){t._clickPos(n,e(this))});this.scrollbar.find(".scrollbar-v-up,.scrollbar-h-up").on("click",function(n){t._fixScroll(1,e(this))});this.scrollbar.find(".scrollbar-v-down,.scrollbar-h-down").on("click",function(n){t._fixScroll(-1,e(this))});this.scrollbar.mousewheel(function(e,n){t._fixScroll(n);return!1})},_removeHandlers:function(){if(!this.handlers)return!1;this.handlers=!1;var t=this;e(document).mousemove(function(e){return!1});e(document).mouseup(function(e){return!1});this.scrollbar.find(".scrollbar-line-v-btn,.scrollbar-line-h-btn").off("mousedown");this.scrollbar.find(".scrollbar-line-v,.scrollbar-line-h").off("click");this.scrollbar.find(".scrollbar-v-up,.scrollbar-h-up").off("click");this.scrollbar.find(".scrollbar-v-down,.scrollbar-h-down").off("click")},_clickPos:function(t,n){if(e(t.target).attr("class")=="scrollbar-line-v"||e(t.target).attr("class")=="scrollbar-line-h"){var r=n.offset();if(e(t.target).attr("class")=="scrollbar-line-v"){var i=t.pageY-r.top,s=n.find(".scrollbar-line-v-btn");this.dragElem={elem:s,width:s.width(),height:s.height(),parent:n,parentWidth:n.width(),parentHeight:n.height(),parentOffset:r};this._scrollTo(0,i,"y");this.dragElem=null}else{var o=t.pageX-r.left,s=n.find(".scrollbar-line-h-btn");this.dragElem={elem:s,width:s.width(),height:s.height(),parent:n,parentWidth:n.width(),parentHeight:n.height(),parentOffset:r};this._scrollTo(o,0,"x");this.dragElem=null}}},_fixScroll:function(e,t){var n=this.options.wheel;if(t!==undefined&&(t.hasClass("scrollbar-h-up")||t.hasClass("scrollbar-h-down"))||this.options.axis=="x"||this.options.axis!="x"&&this.options.axis!="y"&&this.scrollbar.find(".scrollbar-v").length<1){var r=n/this.contentWidth*100,i=(this.options.width-32)/100*r,s=parseInt(this.element.css("left")),o=isNaN(s)?0:Math.abs(s),u=this.scrollbar.find(".scrollbar-line-h-btn"),a=this.scrollbar.find(".scrollbar-line-h"),f=parseFloat(u.css("left")),l=isNaN(f)?0:f;if(e>0)var c=o-n,h=l-i;else var c=o+n,h=l+i;c<0&&(c=0);c>this.contentWidth-this.options.width&&(c=this.contentWidth-this.options.width);var p={width:a.width(),height:a.height()},d={width:u.width(),height:u.height()};h<0&&(h=0);h+d.width>p.width&&(h=p.width-d.width);this.element.css({left:c*-1});u.css({left:h})}else{var r=n/this.contentHeight*100,i=(this.options.height-32)/100*r,v=parseInt(this.element.css("top")),o=isNaN(v)?0:Math.abs(v),u=this.scrollbar.find(".scrollbar-line-v-btn"),a=this.scrollbar.find(".scrollbar-line-v"),m=parseFloat(u.css("top")),l=isNaN(m)?0:m;if(e>0)var g=o-n,y=l-i;else var g=o+n,y=l+i;g<0&&(g=0);g>this.contentHeight-this.options.height&&(g=this.contentHeight-this.options.height);var p={width:a.width(),height:a.height()},d={width:u.width(),height:u.height()};y<0&&(y=0);y+d.height>p.height&&(y=p.height-d.height);this.element.css({top:g*-1});u.css({top:y})}},_scrollTo:function(e,t,n){if(n=="x"){var r=this.options.width-32,i=r/this.contentWidth,s=e/i;s<0&&(s=0);s>this.contentWidth-this.options.width&&(s=this.contentWidth-this.options.width);e<0&&(e=0);e>this.dragElem.parentWidth-this.dragElem.width&&(e=this.dragElem.parentWidth-this.dragElem.width);this.dragElem.elem.css({left:e});this.element.css({left:s*-1})}else{var o=this.options.height-32,i=o/this.contentHeight,u=t/i;u<0&&(u=0);u>this.contentHeight-this.options.height&&(u=this.contentHeight-this.options.height);t<0&&(t=0);t>this.dragElem.parentHeight-this.dragElem.height&&(t=this.dragElem.parentHeight-this.dragElem.height);this.dragElem.elem.css({top:t});this.element.css({top:u*-1})}},_scroll:function(){if(this.dragElem.elem.hasClass("scrollbar-line-h-btn")){var e=this.options.width-32,t=e/this.contentWidth,n=parseInt(this.dragElem.elem.css("left")),r=isNaN(n)?0:Math.abs(n),i=r/t;i<0&&(i=0);i>this.contentWidth-this.options.width&&(i=this.contentWidth-this.options.width);this.element.css({left:i*-1})}else{var s=this.options.height-32,t=s/this.contentHeight,o=parseInt(this.dragElem.elem.css("top")),u=isNaN(o)?0:Math.abs(o),a=u/t;a<0&&(a=0);a>this.contentHeight-this.options.height&&(a=this.contentHeight-this.options.height);this.element.css({top:a*-1})}},_startCoordsDiff:function(e){var t=this.dragElem.elem.offset();this.startCoords.x=e.pageX-t.left;this.startCoords.y=e.pageY-t.top},_dragStart:function(e,t){var n=t.parents().first();this.dragElem={elem:t,width:t.width(),height:t.height(),parent:n,parentWidth:n.width(),parentHeight:n.height(),parentOffset:n.offset()};this.dragStart=!0;this.currCoords.x=e.pageX;this.currCoords.y=e.pageY;this._startCoordsDiff(e)},_drag:function(e){if(this.dragStart){this.currCoords.x=e.pageX;this.currCoords.y=e.pageY;var t=this.currCoords.x-this.startCoords.x-this.dragElem.parentOffset.left,n=this.currCoords.y-this.startCoords.y-this.dragElem.parentOffset.top;t<0&&(t=0);t+this.dragElem.width>=this.dragElem.parentWidth&&(t=this.dragElem.parentWidth-this.dragElem.width);n<0&&(n=0);n+this.dragElem.height>this.dragElem.parentHeight&&(n=this.dragElem.parentHeight-this.dragElem.height);this.dragElem.elem.css({left:t,top:n});this._scroll()}},_dragEnd:function(e){if(this.dragStart){this.dragElem=null;this.dragStart=!1;this.startCoords.x=0;this.startCoords.y=0;this.currCoords.x=null;this.currCoords.y=null}},_destroy:function(){},_setOption:function(e,t){this._super("_setOption",e,t)}})})(jQuery);