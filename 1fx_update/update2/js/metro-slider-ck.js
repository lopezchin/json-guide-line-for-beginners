(function(e){e.widget("metro.slider",{version:"1.0.2",options:{position:0,accuracy:0,color:"default",completeColor:"default",markerColor:"default",colors:[],showHint:!1,change:function(e,t){},changed:function(e,t){},min:0,max:100,animate:!0,_slider:{vertical:!1,offset:0,length:0,marker:0,ppp:0,start:0,stop:0}},_create:function(){var e=this,t=this.element,n=this.options,r=this.options._slider;t.data("accuracy")!=undefined&&(n.accuracy=t.data("accuracy")>0?t.data("accuracy"):0);t.data("animate")!=undefined&&(n.animate=t.data("animate"));t.data("min")!=undefined&&(n.min=t.data("min"));n.min=n.min<0?0:n.min;n.min=n.min>n.max?n.max:n.min;t.data("max")!=undefined&&(n.max=t.data("max"));n.max=n.max>100?100:n.max;n.max=n.max<n.min?n.min:n.max;t.data("position")!=undefined&&(n.position=this._correctValue(t.data("position")>this.options.min?t.data("position")>this.options.max?this.options.max:t.data("position"):this.options.min));t.data("color")!=undefined&&(n.color=t.data("color"));t.data("completeColor")!=undefined&&(n.completeColor=t.data("completeColor"));t.data("markerColor")!=undefined&&(n.markerColor=t.data("markerColor"));t.data("colors")!=undefined&&(n.colors=t.data("colors").split(","));t.data("showHint")!=undefined&&(n.showHint=t.data("showHint"));r.vertical=t.hasClass("vertical");this._createSlider();this._initPoints();this._placeMarker(n.position);addTouchEvents(t[0]);t.children(".marker").on("mousedown",function(t){t.preventDefault();e._startMoveMarker(t)});t.on("mousedown",function(t){t.preventDefault();e._startMoveMarker(t)})},_startMoveMarker:function(t){var n=this.element,r=this.options,i=this,s=n.children(".hint");e(document).mousemove(function(e){i._movingMarker(e);n.hasClass("permanent-hint")||s.css("display","block")});e(document).mouseup(function(){e(document).off("mousemove");e(document).off("mouseup");n.data("value",i.options.position);n.trigger("changed",i.options.position);r.changed(i.options.position,n);n.hasClass("permanent-hint")||s.css("display","none")});this._initPoints();this._movingMarker(t)},_movingMarker:function(e){var t,n,r,i=this.options._slider.vertical,s=this.options._slider.offset,o=this.options._slider.start,u=this.options._slider.stop,a=this.options._slider.length,f=this.options._slider.marker;i?t=e.pageY-s:t=e.pageX-s;t<o?t=o:t>u&&(t=u);i?r=a-t-f/2:r=t-f/2;n=this._pixToPerc(r);this._placeMarker(n);this.options.position=n;this.options.change(Math.round(n),this.element)},_placeMarker:function(e){var t,n,r=this.options,i=0,s=0,o=0,u=this.element.children(".marker"),a=this.element.children(".complete"),f=this.element.children(".hint"),l=this._percToPix(this.options.position);i=r.colors.length;o=r._slider.length/i;if(this.options._slider.vertical){var c=this._percToPix(this.options.position)+this.options._slider.marker,h=this.options._slider.length-c;t=this._percToPix(e)+this.options._slider.marker;n=this.options._slider.length-t;this._animate(u.css("top",h),{top:n});this._animate(a.css("height",c),{height:t});if(i){s=Math.round(t/o)-1;a.css("background-color",r.colors[s<0?0:s])}r.showHint&&f.html(Math.round(e)).css("top",n-f.height()/2)}else{t=this._percToPix(e);this._animate(u.css("left",l),{left:t});this._animate(a.css("width",l),{width:t});if(i){s=Math.round(t/o)-1;a.css("background-color",r.colors[s<0?0:s])}r.showHint&&this._animate(f.html(Math.round(e)).css("left",l-f.width()/2),{left:t-f.width()/2})}},_animate:function(e,t){this.options.animate?e.stop(!0).animate(t):e.css(t)},_pixToPerc:function(e){var t;t=e*this.options._slider.ppp;return this._correctValue(t)},_percToPix:function(e){return this.options._slider.ppp===0?0:e/this.options._slider.ppp},_correctValue:function(e){var t=this.options.accuracy,n=this.options.max,r=this.options.min;if(t===0)return e;if(e===n)return n;if(e===r)return r;e=Math.floor(e/t)*t+Math.round(e%t/t)*t;return e>n?n:e<r?r:e},_initPoints:function(){var e=this.options._slider,t=this.element;if(e.vertical){e.offset=t.offset().top;e.length=t.height();e.marker=t.children(".marker").height()}else{e.offset=t.offset().left;e.length=t.width();e.marker=t.children(".marker").width()}e.ppp=this.options.max/(e.length-e.marker);e.start=e.marker/2;e.stop=e.length-e.marker/2},_createSlider:function(){var t=this.element,n=this.options,r,i,s;t.html("");r=e("<div/>").addClass("complete").appendTo(t);i=e("<a/>").addClass("marker").appendTo(t);n.showHint&&(s=e("<span/>").addClass("hint").appendTo(t));n.color!="default"&&t.css("background-color",n.color);n.completeColor!="default"&&r.css("background-color",n.completeColor);n.markerColor!="default"&&i.css("background-color",n.markerColor)},value:function(e){e=e>this.options.max?this.options.max:e;e=e<this.options.min?this.options.min:e;if(typeof e!="undefined"){this._placeMarker(parseInt(e));this.options.position=parseInt(e);this.options.change(Math.round(parseInt(e)),this.element);return this}return Math.round(this.options.position)},_destroy:function(){},_setOption:function(e,t){this._super("_setOption",e,t)}})})(jQuery);