/*!
 * ---------------------------- DRAGEND JS -------------------------------------
 *
 * Version: <%= pkg.version %>
 * https://github.com/Stereobit/dragend
 * Copyright (c) 2014 Tobias Otte, t@stereob.it
 *
 * Licensed under MIT-style license:
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */(function(e){"use strict";function r(e){function p(){}function d(){return!1}function v(e,t){var n,r;for(n in t)if(t.hasOwnProperty(n)){r=t[n];switch(n){case"height":case"width":case"marginLeft":case"marginTop":r+="px"}e.style[n]=r}return e}function m(e,t){var n;for(n in t)e[n]=t[n];return e}function g(e,t){return function(){return e.apply(t,Array.prototype.slice.call(arguments))}}function y(t,n){var r;e?r=e(n).find("."+t):r=Array.prototype.slice.call(n.getElementsByClassName(t));return r}function b(t,n,r,i,s){var o={};o[n]=r;e?e(t).animate(o,i,s):v(t,o)}function w(e){var t=e.touches,n=t&&t.length?t:e.changedTouches;return{x:i?n[0].pageX:e.pageX,y:i?n[0].pageY:e.pageY}}function E(e,n){var i=m({},r);this.settings=m(i,n);this.container=e;this.pageContainer=t.createElement("div");this.scrollBorder={x:0,y:0};this.page=0;this.preventScroll=!1;this.pageCssProperties={margin:0};this._onStart=g(this._onStart,this);this._onMove=g(this._onMove,this);this._onEnd=g(this._onEnd,this);this._onKeydown=g(this._onKeydown,this);this._sizePages=g(this._sizePages,this);this._afterScrollTransform=g(this._afterScrollTransform,this);this.pageContainer.innerHTML=e.cloneNode(!0).innerHTML;e.innerHTML="";e.appendChild(this.pageContainer);this._scroll=h?this._scrollWithTransform:this._scrollWithoutTransform;this._animateScroll=h?this._animateScrollWithTransform:this._animateScrollWithoutTransform;v(e,l);setTimeout(g(function(){this.updateInstance(n);this.settings.preventDrag||this._observe();this.settings.afterInitialize.call(this)},this),10)}function S(t,n,r){e?e(t).on(n,r):t.addEventListener(n,r,!1)}function x(t,n,r){e?e(t).off(n,r):t.removeEventListener(n,r,!1)}var r={pageClass:"dragend-page",direction:"horizontal",minDragDistance:"40",onSwipeStart:p,onSwipeEnd:p,onDragStart:p,onDrag:p,onDragEnd:p,afterInitialize:p,keyboardNavigation:!1,stopPropagation:!1,itemsInPage:1,scribe:0,borderBetweenPages:0,duration:70,preventDrag:!1},i="ontouchstart"in n,s=i?"touchstart":"mousedown",o=i?"touchmove":"mousemove",u=i?"touchend":"mouseup",a={37:"left",38:"up",39:"right",40:"down"},f={pages:"No pages found"},l={overflow:"hidden",padding:0},c=function(){var e=t.createElement("div"),n="Khtml Ms O Moz Webkit".split(" "),r=n.length;return function(t){if(t in e.style)return!0;t=t.replace(/^[a-z]/,function(e){return e.toUpperCase()});while(r--)if(n[r]+t in e.style)return!0;return!1}}(),h=c("transform");m(E.prototype,{_checkOverscroll:function(e,t,n){var r={x:t,y:n,overscroll:!0};switch(e){case"right":if(!this.scrollBorder.x){r.x=Math.round((t-this.scrollBorder.x)/5);return r}break;case"left":if((this.pagesCount-1)*this.pageDimentions.width<=this.scrollBorder.x){r.x=Math.round(-((Math.ceil(this.pagesCount)-1)*(this.pageDimentions.width+this.settings.borderBetweenPages))+t/5);return r}break;case"down":if(!this.scrollBorder.y){r.y=Math.round((n-this.scrollBorder.y)/5);return r}break;case"up":if((this.pagesCount-1)*this.pageDimentions.height<=this.scrollBorder.y){r.y=Math.round(-((Math.ceil(this.pagesCount)-1)*(this.pageDimentions.height+this.settings.borderBetweenPages))+n/5);return r}}return{x:t-this.scrollBorder.x,y:n-this.scrollBorder.y,overscroll:!1}},_observe:function(){S(this.container,s,this._onStart);this.container.onselectstart=d;this.container.ondragstart=d;this.settings.keyboardNavigation&&S(t.body,"keydown",this._onKeydown);S(n,"resize",this._sizePages)},_onStart:function(e){e=e.originalEvent||e;this.settings.stopPropagation&&e.stopPropagation();S(t.body,o,this._onMove);S(t.body,u,this._onEnd);this.startCoords=w(e);this.settings.onDragStart.call(this,e)},_onMove:function(e){e=e.originalEvent||e;if(e.touches&&e.touches.length>1||e.scale&&e.scale!==1)return;e.preventDefault();this.settings.stopPropagation&&e.stopPropagation();var t=this._parseEvent(e),n=this._checkOverscroll(t.direction,-t.distanceX,-t.distanceY);this.settings.onDrag.call(this,this.activeElement,t,n.overscroll,e);this.preventScroll||this._scroll(n)},_onEnd:function(e){e=e.originalEvent||e;this.settings.stopPropagation&&e.stopPropagation();var n=this._parseEvent(e);this.startCoords={x:0,y:0};Math.abs(n.distanceX)>this.settings.minDragDistance||Math.abs(n.distanceY)>this.settings.minDragDistance?this.swipe(n.direction):(n.distanceX>0||n.distanceX>0)&&this._scrollToPage();this.settings.onDragEnd.call(this,this.container,this.activeElement,this.page,e);x(t.body,o,this._onMove);x(t.body,u,this._onEnd)},_parseEvent:function(e){var t=w(e),n=this.startCoords.x-t.x,r=this.startCoords.y-t.y;return this._addDistanceValues(n,r)},_addDistanceValues:function(e,t){var n={distanceX:0,distanceY:0};if(this.settings.direction==="horizontal"){n.distanceX=e;n.direction=e>0?"left":"right"}else{n.distanceY=t;n.direction=t>0?"up":"down"}return n},_onKeydown:function(e){var t=a[e.keyCode];t&&this._scrollToPage(t)},_setHorizontalContainerCssValues:function(){m(this.pageCssProperties,{cssFloat:"left",overflowY:"auto",overflowX:"hidden",padding:0,display:"block"});v(this.pageContainer,{overflow:"hidden",width:(this.pageDimentions.width+this.settings.borderBetweenPages)*this.pagesCount,boxSizing:"content-box","-webkit-backface-visibility":"hidden","-webkit-perspective":1e3,margin:0,padding:0})},_setVerticalContainerCssValues:function(){m(this.pageCssProperties,{overflow:"hidden",padding:0,display:"block"});v(this.pageContainer,{"padding-bottom":this.settings.scribe,boxSizing:"content-box","-webkit-backface-visibility":"hidden","-webkit-perspective":1e3,margin:0})},setContainerCssValues:function(){this.settings.direction==="horizontal"?this._setHorizontalContainerCssValues():this._setVerticalContainerCssValues()},_setPageDimentions:function(){var e=this.container.offsetWidth,t=this.container.offsetHeight;this.settings.direction==="horizontal"?e-=parseInt(this.settings.scribe,10):t-=parseInt(this.settings.scribe,10);this.pageDimentions={width:e,height:t}},_sizePages:function(){var e=this.pages.length;this._setPageDimentions();this.setContainerCssValues();this.settings.direction==="horizontal"?m(this.pageCssProperties,{height:this.pageDimentions.height,width:this.pageDimentions.width/this.settings.itemsInPage}):m(this.pageCssProperties,{height:this.pageDimentions.height/this.settings.itemsInPage,width:this.pageDimentions.width});for(var t=0;t<e;t++)v(this.pages[t],this.pageCssProperties);this._jumpToPage("page",this.page)},_calcNewPage:function(e,t){var n=this.settings.borderBetweenPages,r=this.pageDimentions.height,i=this.pageDimentions.width,s=this.page;switch(e){case"up":if(s<this.pagesCount-1){this.scrollBorder.y=this.scrollBorder.y+r+n;this.page++}break;case"down":if(s>0){this.scrollBorder.y=this.scrollBorder.y-r-n;this.page--}break;case"left":if(s<this.pagesCount-1){this.scrollBorder.x=this.scrollBorder.x+i+n;this.page++}break;case"right":if(s>0){this.scrollBorder.x=this.scrollBorder.x-i-n;this.page--}break;case"page":switch(this.settings.direction){case"horizontal":this.scrollBorder.x=(i+n)*t;break;case"vertical":this.scrollBorder.y=(r+n)*t}this.page=t;break;default:this.scrollBorder.y=0;this.scrollBorder.x=0;this.page=0}},_onSwipeEnd:function(){this.preventScroll=!1;this.activeElement=this.pages[this.page*this.settings.itemsInPage];this.settings.onSwipeEnd.call(this,this.container,this.activeElement,this.page)},_jumpToPage:function(e,t){e&&this._calcNewPage(e,t);this._scroll({x:-this.scrollBorder.x,y:-this.scrollBorder.y})},_scrollToPage:function(e,t){this.preventScroll=!0;e&&this._calcNewPage(e,t);this._animateScroll()},_scrollWithTransform:function(e){var t=this.settings.direction==="horizontal"?"translateX("+e.x+"px)":"translateY("+e.y+"px)";v(this.pageContainer,{"-webkit-transform":t,"-moz-transform":t,"-ms-transform":t,"-o-transform":t,transform:t})},_animateScrollWithTransform:function(){var e="transform "+this.settings.duration+"ms ease-out",t=this.container,n=this._afterScrollTransform;v(this.pageContainer,{"-webkit-transition":"-webkit-"+e,"-moz-transition":"-moz-"+e,"-ms-transition":"-ms-"+e,"-o-transition":"-o-"+e,transition:e});this._scroll({x:-this.scrollBorder.x,y:-this.scrollBorder.y});S(this.container,"webkitTransitionEnd",n);S(this.container,"oTransitionEnd",n);S(this.container,"transitionend",n);S(this.container,"transitionEnd",n)},_afterScrollTransform:function(){var e=this.container,t=this._afterScrollTransform;this._onSwipeEnd();x(e,"webkitTransitionEnd",t);x(e,"oTransitionEnd",t);x(e,"transitionend",t);x(e,"transitionEnd",t);v(this.pageContainer,{"-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"",transition:""})},_scrollWithoutTransform:function(e){var t=this.settings.direction==="horizontal"?{marginLeft:e.x}:{marginTop:e.y};v(this.pageContainer,t)},_animateScrollWithoutTransform:function(){var e=this.settings.direction==="horizontal"?"marginLeft":"marginTop",t=this.settings.direction==="horizontal"?-this.scrollBorder.x:-this.scrollBorder.y;b(this.pageContainer,e,t,this.settings.duration,g(this._onSwipeEnd,this))},swipe:function(e){this.settings.onSwipeStart.call(this,this.container,this.activeElement,this.page);this._scrollToPage(e)},updateInstance:function(e){e=e||{};typeof e=="object"&&m(this.settings,e);this.pages=y(this.settings.pageClass,this.pageContainer);if(!this.pages.length)throw new Error(f.pages);this.pagesCount=this.pages.length/this.settings.itemsInPage;this.activeElement=this.pages[this.page*this.settings.itemsInPage];this._sizePages();if(this.settings.jumpToPage){this.jumpToPage(e.jumpToPage);delete this.settings.jumpToPage}if(this.settings.scrollToPage){this.scrollToPage(this.settings.scrollToPage);delete this.settings.scrollToPage}},destroy:function(){var e=this.container;x(e,s);x(e,o);x(e,u);x(t.body,"keydown",this._onKeydown);x(n,"resize",this._sizePages);e.removeAttribute("style");for(var r=0;r<this.pages.length;r++)this.pages[r].removeAttribute("style");e.innerHTML=this.pageContainer.innerHTML},scrollToPage:function(e){this._scrollToPage("page",e-1)},jumpToPage:function(e){this._jumpToPage("page",e-1)}});e&&(e.fn.dragend=function(t){t=t||{};this.each(function(){var n=e(this).data("dragend");if(n)n.updateInstance(t);else{n=new E(this,t);e(this).data("dragend",n)}typeof t=="string"&&n.swipe(t)});return this});return E}var t=document,n=e;typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return r(n.jQuery||n.Zepto)}):n.Dragend=r(n.jQuery||n.Zepto)})(window);