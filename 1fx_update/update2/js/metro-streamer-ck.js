(function(e){e.widget("metro.streamer",{version:"1.0.0",options:{scrollBar:!1,meter:{start:9,stop:19,interval:20},slideToGroup:1,slideToTime:"10:20",slideSleep:1e3,slideSpeed:1e3,onClick:function(e){},onLongClick:function(e){}},_create:function(){var t=this,n=this.element,r=this.options,i=n.find(".stream"),s=n.find(".event"),o=n.find(".events"),u=n.find(".events-area"),a=n.find(".event-group"),f=n.find(".event-stream");n.data("scrollBar")!=undefined&&(r.scrollBar=n.data("scrollBar"));n.data("meterStart")!=undefined&&(r.meter.start=parseInt(n.data("meterStart")));n.data("meterStop")!=undefined&&(r.meter.stop=parseInt(n.data("meterStop")));n.data("meterInterval")!=undefined&&(r.meter.interval=n.data("meterInterval"));n.data("slideToGroup")!=undefined&&(r.slideToGroup=parseInt(n.data("slideToGroup")));n.data("slideSleep")!=undefined&&(r.slideSleep=parseInt(n.data("slideSleep")));n.data("slideSpeed")!=undefined&&(r.slideSpeed=parseInt(n.data("slideSpeed")));n.data("streamSelect",-1);var l=e("<ul/>").addClass("meter"),c,h,p,d=r.meter.start,v=r.meter.stop,m=r.meter.interval,g=[];for(c=d;c<v;c++)for(h=0;h<60;h+=m){p=(c<10?"0"+c:c)+":"+(h<10?"0"+h:h);e("<li/>").addClass("js-interval-"+p.replace(":","-")).html("<em>"+p+"</em>").appendTo(l);g.push(p)}n.data("intervals",g);l.insertBefore(n.find(".events-grid"));n.find(".event-stream").each(function(t,n){var r=0,s=e(n).find(".event");s.each(function(t,n){r+=e(n).outerWidth()});e(n).css({width:r+(s.length-1)*2+1});e(n).find(".time").css("background-color",e(i[t]).css("background-color"))});o.css({"overflow-x":r.scrollBar?"scroll":"hidden"});n.css({height:n.find(".streams").outerHeight()+(r.scrollBar?20:0)});var y=0;a.each(function(t,n){y+=e(n).outerWidth()});y+=(a.length-1)*2+10;u.css("width",y);s.each(function(e,t){addTouchEvents(t)});s.mousedown(function(t){t.altKey&&e(this).toggleClass("selected")});n.mousewheel(function(e,t){var n=t*50;o.scrollLeft(o.scrollLeft()-n);return!1});i.each(function(t,r){e(r).mousedown(function(r){if(n.data("streamSelect")==t){s.removeClass("event-disable");n.data("streamSelect",-1)}else{n.data("streamSelect",t);s.addClass("event-disable");e(f[t]).find(".event").removeClass("event-disable")}})});s.on("click",function(t){t.preventDefault();r.onClick(e(this))});s.on("longclick",function(t){e(this).toggleClass("selected");t.preventDefault();r.onLongClick(e(this))});n.find(".js-go-previous-time").on("click",function(e){var i=n.data("intervals").indexOf(n.data("current-time"));if(i==0)return;i--;var s=n.data("intervals")[i];t.slideToTime(s,0,r.slideSpeed)});n.find(".js-go-next-time").on("click",function(e){var i=n.data("intervals").indexOf(n.data("current-time"));if(i==n.data("intervals").length-1)return;i++;var s=n.data("intervals")[i];t.slideToTime(s,0,r.slideSpeed)});n.find(".js-show-all-streams").on("click",function(e){n.find(".event").removeClass("event-disable");n.data("streamSelect",-1);e.preventDefault()});n.find(".js-schedule-mode").on("click",function(t){e(this).toggleClass("inverse");n.data("schedule-mode",e(this).hasClass("inverse"));t.preventDefault()});r.slideToTime?this.slideToTime(r.slideToTime,r.slideSleep,r.slideSpeed):this.slideToGroup(r.slideToGroup,r.slideSleep,r.slideSpeed)},slideToTime:function(e,t,n){var r=this,i=this.element,s=i.find(".meter li.js-interval-"+e.replace(":","-"))[0],o=i.find(".streams").outerWidth()+2;setTimeout(function(){i.find(".events").animate({scrollLeft:"+="+(s.offsetLeft-o)},n,function(){r._afterSlide()})},t);i.data("current-time",e)},slideToGroup:function(e,t,n){var r=this,i=this.element,s=i.find(".event-group"),o=i.find(".streams").outerWidth()+2;setTimeout(function(){i.find(".events").animate({scrollLeft:"+="+(s[e-1].offsetLeft-o)},n,function(){r._afterSlide()})},t)},_afterSlide:function(){},_destroy:function(){},_setOption:function(e,t){this._super("_setOption",e,t)}})})(jQuery);