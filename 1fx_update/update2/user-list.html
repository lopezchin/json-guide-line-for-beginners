<!DOCTYPE html>
<html>
<head>
	<title>Detail Admin - User list</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
    <!-- bootstrap -->
    <link href="css/bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="css/bootstrap/bootstrap-overrides.css" type="text/css" rel="stylesheet" />

    <!-- global styles -->
    <link rel="stylesheet" type="text/css" href="css/compiled/layout.css" />
    <link rel="stylesheet" type="text/css" href="css/compiled/elements.css" />
    <link rel="stylesheet" type="text/css" href="css/compiled/icons.css" />

   

    <!-- libraries -->
    <link href="css/lib/font-awesome.css" type="text/css" rel="stylesheet" />
    
    <!-- this page specific styles -->
    <link rel="stylesheet" href="css/compiled/user-list.css" type="text/css" media="screen" />

    <!-- open sans font -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css' />

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
</head>
<body>

    <!-- navbar -->
    <header class="navbar navbar-inverse" role="banner">
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" id="menu-toggler">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
             <a class="navbar-brand"><img class="logo" src="images/logo_dashboard.svg" alt="logo" /></a>
        </div>
       
        <ul class="nav navbar-nav pull-right hidden-xs">
              <li class="hidden-xs">
                <input type="hidden" class="token" id="token"/>
                <input type="hidden" class="email" id="email"/>
                <input class="search" type="text" />
            </li>
          
            <li class="notification-dropdown hidden-xs hidden-sm">
                <a href="#" class="trigger">
                    <i class="fa fa-exclamation-triangle fa-lg"></i>
                    <span class="count">6</span>
                </a>
                <div class="pop-dialog">
                    <div class="pointer right">
                        <div class="arrow"></div>
                        <div class="arrow_border"></div>
                    </div>
                    <div class="body">
                        <a href="#" class="close-icon"><i class="icon-remove-sign"></i></a>
                        <div class="notifications">
                            <h3>You have 6 new notifications</h3>
                            <a href="#" class="item">
                                <i class="icon-signin"></i> New user registration
                                <span class="time"><i class="icon-time"></i> 13 min.</span>
                            </a>
                            <a href="#" class="item">
                                <i class="icon-signin"></i> New user registration
                                <span class="time"><i class="icon-time"></i> 18 min.</span>
                            </a>
                            <a href="#" class="item">
                                <i class="icon-envelope-alt"></i> New message from Alejandra
                                <span class="time"><i class="icon-time"></i> 28 min.</span>
                            </a>
                            <a href="#" class="item">
                                <i class="icon-signin"></i> New user registration
                                <span class="time"><i class="icon-time"></i> 49 min.</span>
                            </a>
                            <a href="#" class="item">
                                <i class="icon-download-alt"></i> New order placed
                                <span class="time"><i class="icon-time"></i> 1 day.</span>
                            </a>
                            <div class="footer">
                                <a href="#" class="logout">View all notifications</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="notification-dropdown hidden-xs hidden-sm">
                <a href="#" class="trigger">
                    <i class="fa fa-envelope fa-lg"></i>
                </a>
                <div class="pop-dialog">
                    <div class="pointer right">
                        <div class="arrow"></div>
                        <div class="arrow_border"></div>
                    </div>
                    <div class="body">
                        <a href="#" class="close-icon"><i class="icon-remove-sign"></i></a>
                        <div class="messages">
                            <a href="#" class="item">
                                <img src="img/contact-img.png" class="display" alt="user" />
                                <div class="name">Alejandra Galván</div>
                                <div class="msg">
                                    There are many variations of available, but the majority have suffered alterations.
                                </div>
                                <span class="time"><i class="icon-time"></i> 13 min.</span>
                            </a>
                            <a href="#" class="item">
                                <img src="img/contact-img2.png" class="display" alt="user" />
                                <div class="name">Alejandra Galván</div>
                                <div class="msg">
                                    There are many variations of available, have suffered alterations.
                                </div>
                                <span class="time"><i class="icon-time"></i> 26 min.</span>
                            </a>
                            <a href="#" class="item last">
                                <img src="img/contact-img.png" class="display" alt="user" />
                                <div class="name">Alejandra Galván</div>
                                <div class="msg">
                                    There are many variations of available, but the majority have suffered alterations.
                                </div>
                                <span class="time"><i class="icon-time"></i> 48 min.</span>
                            </a>
                            <div class="footer">
                                <a href="#" class="logout">View all messages</a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="dropdown">
                <a href="#" class="dropdown-toggle hidden-xs hidden-sm" data-toggle="dropdown">
                    Your account
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="personal-info.html">Personal info</a></li>
                    <li><a href="#">Account settings</a></li>
                    <li><a href="#">Billing</a></li>
                    <li><a href="#">Export your data</a></li>
                    <li><a href="#">Send feedback</a></li>
                </ul>
            </li>

             <li class="settings hidden-xs hidden-sm">
                <a href="#" id="logout" class="trigger">
                    <i class="fa fa-power-off fa-lg"></i>
                </a>
                 <div class="pop-dialog">
                 dfdf
                 </div>
            </li>
        </ul>
    </header>
    <!-- end navbar -->

    <!-- sidebar -->
    <div id="sidebar-nav">
        <ul id="dashboard-menu">
            <li>
                <a href="dashboard.html">
                    <i class="fa fa-home fa-lg"></i>
                    <span>Dashboard</span>
                </a>
            </li>  
            <li>
                <a  href="credits.html">
                    <i class="fa fa-credit-card fa-lg"></i>
                    <span>Credits</span>
                </a>
            </li>
            <li>
                <a href="transaction.html">
                   <i class="fa fa fa-file-text fa-lg"></i>
                  <span>Transaction</span>
                    
                </a>
            </li>
            <li class="active">
                 <div class="pointer">
                    <div class="arrow"></div>
                    <div class="arrow_border"></div>
                </div>
                <a href="user-list.html">
                     <i class="fa fa-users fa-lg"></i>
                    <span>Contacts</span>
                </a>
            </li>
            <li>
                <a href="personal-info.html">
                    <i class="fa fa-user fa-lg"></i>
                    <span>Profile</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- end sidebar -->
    

	<!-- main container -->
    <div class="content">

        <div id="pad-wrapper" class="users-list">
            <div class="row header">
                <h3>Users</h3>
                <div class="col-md-10 col-sm-12 col-xs-12 pull-right">
                    <input type="text" class="col-md-5 search" placeholder="Type a user's name...">
                    
                    <!-- custom popup filter -->
                    <!-- styles are located in css/elements.css -->
                    <!-- script that enables this dropdown is located in js/theme.js -->
                    <div class="ui-dropdown">
                        <div class="head" data-toggle="tooltip" title="Click me!">
                            Filter users
                            <i class="arrow-down"></i>
                        </div>  
                        <div class="dialog">
                            <div class="pointer">
                                <div class="arrow"></div>
                                <div class="arrow_border"></div>
                            </div>
                            <div class="body">
                                <p class="title">
                                    Show users where:
                                </p>
                                <div class="form">
                                    <select>
                                        <option>Name</option>
                                        <option>Email</option>
                                        <option>Number of orders</option>
                                        <option>Signed up</option>
                                        <option>Last seen</option>
                                    </select>
                                    <select>
                                        <option>is equal to</option>
                                        <option>is not equal to</option>
                                        <option>is greater than</option>
                                        <option>starts with</option>
                                        <option>contains</option>
                                    </select>
                                    <input type="text" class="form-control" />
                                    <a class="btn-flat small">Add filter</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <a href="new-user.html" class="btn-flat success pull-right">
                        <span>&#43;</span>
                        NEW USER
                    </a>
                </div>
            </div>

            <!-- Users table -->
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="col-md-4 sortable">
                                    Name
                                </th>
                                <th class="col-md-3 sortable user_signin_thead">
                                    <span class="line"></span>Address
                                </th>
                                <th class="col-md-2 sortable">
                                    <span class="line"></span>Total spent
                                </th>
                                <th class="col-md-3 sortable align-right">
                                    <span class="line"></span>Email
                                </th>
                                <th class="col-md-3 sortable align-right">
                                    <span class="line"></span>Action
                                </th>
                            </tr>
                        </thead>
                        <tbody id="contact_friend">
                        <!-- row -->
                        <!-- <tr class="first">
                            <td>
                                <img src="img/contact-img.png" alt="contact" class="img-circle avatar hidden-phone" />
                                <a href="user-profile.html" class="name">Alejandra Galvan Castillo</a>
                                <span class="subtext">Graphic Design</span>
                            </td>
                            <td>
                                Mar 13, 2012
                            </td>
                            <td>
                                $ 4,500.00
                            </td>
                            <td class="align-right">
                                <a href="#">alejandra@canvas.com</a>
                            </td>
                        </tr>
                        
                       -->
                        </tbody>
                        <tfoot id="contact_request">
                        </tfoot>
                    </table>
                </div>                
            </div>
            <ul class="pagination pull-right">
                <li><a href="#">&#8249;</a></li>
                <li class="active"><a href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a href="#">5</a></li>
                <li><a href="#">&#8250;</a></li>
            </ul>
            <!-- end users table -->
        </div>
    </div>
    <!-- end main container -->
    <script src="js/1.9.1_jquery.min.js"></script>
    <script src="js/jquery.js"></script>
    <script type="text/javascript" src="js/ext/jquery.easing.min.js"></script>  
    <script src="js/bootstrap.min.js"></script>

    <script src="js/jquery-ui-1.10.3.custom.min.js" ></script>
    <script type="text/javascript">
        $(document).ready(function(){
           
            $.ajax({
              type: "POST",
              url: "http://192.168.1.70/TCC/auth.php",
              dataType: "json",
              success: function(result) {
                console.log(result);
                console.log('status = '+result.status);
                

                if (result.status == "success") {
                    var tokenKey = result.token_id,
                        email = result.email;

                    $('#token').val(tokenKey);
                    $('#email').val(email);

                    contact_friend_requesting(email);

                    contact_friend_pending(email);

                    contact_friend_active(email);

                } else {
                    var redirect = result.redirect;

                    $('#update_prof').html(result.message);
                    $(".bs-example-modal-sm").modal('show');
                    
                    window.location = redirect;
                }
              }
            });

            function contact_friend_active(email){
                $.ajax({ //working
                  type: 'POST',
                  dataType: 'json',
                  url: 'http://192.168.1.70/controller/contact/fetch_all_contact.php?status=friend', //perfectly working
                  data:{
                    'email': email,
                    '_token' : '',
                    'action' : 'request_active'
                  },
                  success: function(contact_fetch_data) {

                    console.log(contact_fetch_data);

                    $.each( contact_fetch_data, function( key, value ) {

                      var contact_result = '<tr><td><img src="http://192.168.1.70/controller/uploads/'+value.avatar+'" alt="image" class="img-circle avatar hidden-phone" width="120" height="45"/><a href="user-profile.html" class="name" >'+value.fullname+'</a><span class="subtext">'+value.company+'</span></td><td>'+value.address+'</td><td>$ 549.99</td><td class="align-right"><a href="#" >'+value.email+'</a></td><td>'+value.request_status+'</td></tr>';

                      $("#contact_friend").append(contact_result); //use append when you are using the each loop for ajax
                    });   
                  }
                }); 
            }

            function contact_friend_requesting(email){

                $.ajax({ //working
                  type: 'POST',
                  dataType: 'json',
                  url: 'http://192.168.1.70/controller/contact/fetch_all_contact.php?status=requesting', //perfectly working
                  data:{
                    'email': email,
                    '_token' : '',
                    'action' : 'requesting'
                  },
                  success: function(contact_fetch_data) {

                    console.log(contact_fetch_data);

                    $.each( contact_fetch_data, function( key, value ) {

                      var contact_result = '<tr><td><img src="http://192.168.1.70/controller/uploads/'+value.avatar+'" alt="image" class="img-circle avatar hidden-phone" width="120" height="45"/><a href="user-profile.html" class="name">'+value.fullname+'</a><span class="subtext">'+value.company+'</span></td><td>'+value.address+'</td><td>$ 549.99</td><td class="align-right"><a href="#">'+value.email+'</a></td><td>'+value.request_status+'</td></tr>';

                      $("#contact_friend").append(contact_result); //use append when you are using the each loop for ajax
                    });   
                  }
                }); 
            }

            function contact_friend_pending(email){

                 $.ajax({ //working
                  type: 'POST',
                  dataType: 'json',
                  url: 'http://192.168.1.70/controller/contact/fetch_all_contact.php?status=pending', //perfectly working
                  data:{
                    'email': email,
                    '_token' : '',
                    'action' : 'request_pending'
                  },
                  success: function(contact_fetch_data) {

                    console.log(contact_fetch_data);

                    $.each( contact_fetch_data, function( key, value ) {

                      var contact_result = '<tr><td><img src="http://192.168.1.70/controller/uploads/'+value.avatar+'" alt="image" class="img-circle avatar hidden-phone" width="120" height="45"/><a href="user-profile.html" class="name">'+value.fullname+'</a><span class="subtext">'+value.company+'</span></td><td>'+value.address+'</td><td>$ 549.99</td><td class="align-right"><a href="#">'+value.email+'</a></td><td>'+value.request_status+'</td><td><a href="#" class="btn btn-primary btn-xs actionBtn" data-action="accept" data-emailrequesting="'+value.id+'"><i class="fa fa-check"></i><a/></td><td><a href="#" class="btn btn-default btn-xs actionBtn" data-action="cancel" data-emailrequesting="'+value.id+'" ><i class="fa fa-times"></i><a/></td></tr>';

                      $("#contact_friend").append(contact_result); //use append when you are using the each loop for ajax
                    });   
                  }
                }); 
            }


            $(document).on("click", ".actionBtn", function(){

                var action = $(this).data("action"),
                    add_email = $(this).data("emailrequesting"),
                    current_email = $("#email").val();

                if(action == "accept"){
                    // alert(action+"\n\n"+current_email+"\n\n"+add_email);
                    $.ajax({
                      type: "POST",
                      url: "http://192.168.1.70/controller/contact/accept_friend_request.php",
                      dataType: "json",
                      data:{
                        'current_email': current_email,
                        'add_email': add_email,
                        '_token': "",
                        'action': action
                      },
                      success: function(result) {

                        if(result.status === 'success'){
                            location.reload();
                            // window.redirect = result.redirect;
                        }
                        else{
                            // window.redirect = result.redirect;
                        }
                      }
                    });


                }else{

                    alert(action+"\n\n"+current_email+"\n\n"+add_email);
                }
            });
            
            $("#logout").click(function (e) {
                e.preventDefault();
                $.ajax({
                  type: "POST",
                  url: "http://192.168.1.70/controller/logout.php",
                  dataType: "json",
                  data:{
                    'logging_out': 'logout',
                    '_token': "",
                    'action': 'logout_app'
                  },
                  success: function(result) {

                    if(result.status === 'logout'){
                        alert("Thanks for using 1FX Mobile Wallet.");
                        window.location = result.redirect;
                    }
                    else{
                        // window.redirect = result.redirect;
                    }
                  }
                });
                // logout();
            });// logout ajax

        });// end document type
    </script>
</body>
</html>